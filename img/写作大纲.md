太好了！下面给出一套**ICLR 9页正文 + 充实附录**的完整结构设计，兼顾你的理论大纲（§1–§5）与现有实验/代码产物，并把**图表位置**、**页面预算**、**附录–正文去重边界**都明确标注。正文里的定理只给**最小可读陈述**；**全部证明**与实现细节放入附录，做到“滴水不漏”。（文中以“Fig./Tab./Alg.”编号建议和页面预算仅供排版时微调。）

> 说明：下文对实验数字与图的引用，来自你上传的实验报告 PDF（编译误差、等变通过率、Imax 消融等）与脚本 `exp1.py / exp2.py / exp3.py / compiler.py / run.py`，便于你在正文/附录中**可追溯复现**。例如：FFN 的编译误差与局部-L 统计分布、FGSM 成功率差异见报告第 2–3 页；CNN 的等变热图与通过率见第 4–5 页；GNN 的置换等变与 Imax 分布、收敛曲线与消融见第 6–8 页。 运行脚本的入口与实验实现分别在 `run.py`、`exp1.py`、`exp2.py`、`exp3.py` 与 `compiler.py`。

------

## 一、ICLR 正文（≤9 页，双栏）——按你的研究大纲 §1–§5 紧凑呈现

> **总页数预算**（可 ±0.3pp 微调）：
>  §1 1.0pp · §2 1.2pp · §3 2.5pp · §4 1.7pp · §5 2.1pp · 结语/致谢/局限 0.5pp · 参考文献独立页

### §1 引言与定位（≈1.0 页）

- **问题与动机**：CPWL 网络的“片段几何”可精确分析，但静态展开指数爆炸。
- **方法概览**：提出**SWT（带守卫的符号加权变换器）\**与\**JIT‑SWT（按需细化）**；在“访问子域与必要比较数”上线性增长，**任意时上下界** + “完全细化即精确”。
- **贡献点**（对齐你大纲 1.4）：
  1. CPWL 层演算与 SWT 静态真值语义；
  2. JIT‑SWT 的对象/不变式/细化器与 DYN‑1…6；
  3. 几何（区域/梯度/Lipschitz/极值）与验证/等变/因果在 JIT 上的可判定化；
  4. 小而充分的三线实验（FFN/CNN/GNN）**验证与应用**：编译等价到 1e‑6–1e‑7；鲁棒性相关、等变性定位、Imax 驱动消融。**（图中数值来自实验报告）** 
- **相关工作（浓缩到一段）**：Max‑of‑Affine/热带代数、MILP/锥松弛、抽象解释/CEGAR、自动机/加权自动机，与本文“函数权 + 守卫 + 按需细化”的差异。

**图表**

- **Fig.1（首页右栏）**：**贡献地图 + 框架鸟瞰**（SWT→JIT‑SWT→GEO/VER/CAU 用例管线）。
- **Tab.1（首页下方）**：**核心定理索引表**（正文仅列名称/直观意义；完整证明在附录）。

------

### §2 设定与静态基线：SWT 真值语义（≈1.2 页）

- **CPWL 与函数半环**（简述）：$(\mathrm{CPWL}^{\pm\infty},\oplus=\max,\otimes=+)$；AF‑1…5 **只陈述**。
- **SWT 语义**：守卫库（H‑形式多面体）、函数权、路径求值与并行择优；**SWT‑1（等价编译）\**给出\**定理声明**与 1 行要义（证明移附录）。
- **编译规则速览**：仿射/BN/残差、ReLU/LReLU/PReLU/Abs、按点 Max/池化、卷积/GNN 模板别名（**规则细节与边界入附录**）。
- **规模上界提示**：SWT‑2（无环；规模与比较面数线性相关）**给出定性表述**，常数与精确上界见附录。

**图表**

- **Fig.2（本节右栏）**：**静态 SWT 编译流程图**（层→守卫交→候选→赢家域）。

------

### §3 动态编译（JIT‑SWT）：对象、算子与保证（≈2.5 页）

- **对象与不变式**：守卫库/GuardSet、e‑graph `Expr`、**不变式 I–III**（唯一守卫/按需细化/上下包络）。
- **原子细化器**：`ENSURE_SIGN`、`ENSURE_WINNER`、`ENSURE_COMMON_REFINE`（伪代码 3–5 行即可；完整算法入附录）。
- **上下包络与单调性**：**DYN‑1**（健全）、**引理：LB/UB 保序/单调**（证明入附录）。
- **任意时精确 & 不回退**：**DYN‑2/DYN‑3**（定义“局部完全细化”+ 直觉图）。
- **预算化上界**：**DYN‑4**（与细分步数/新增守卫线性）；**DYN‑5**（支配剪枝）——定理陈述 + 1 句检查条件（LP/SOCP）。
- **判定性**：**DYN‑6**（允许有限细化 + 公平策略 ⇒ 判定）；并给“真/假/未知 + 证书”的 anytime 叙述（示意即可）。
- **静态–动态等价（DYN‑7）**：完全细化覆盖 ⇒ 与静态 SWT 逐点一致。

**图表/算法**

- **Alg.1（本节左栏）**：**JIT‑B&B 主循环**（十行伪码）。
- **Fig.3（右栏）**：**Imax 的 B&B 收敛曲线**（取你报告中的 Channel‑0 收敛图，展示 anytime 收敛）。

------

### §4 JIT 上的可判定分析与函数几何（≈1.7 页）

- **线性区域与梯度/雅可比**：给出**GEO‑1/4**的结论性陈述（区域内单仿射与 a.e. 可微；边界 Clarke 代表）与**如何在 JIT 读取**（证明与构造入附录）。
- **极值与 Lipschitz**：**GEO‑2/5**给**公式**（标量 $L_p=\max_S\|w_S\|_{p^*}$，向量 $L_{p\to r}=\max_S\|J_S\|_{p\to r}$）与在 JIT 的 anytime 上下界；LP/SOCP 子问题表入附录。
- **验证/等变/因果**：**VER‑1/2/3、CAU‑1/2**只给“产品构造 + JIT‑B&B = 证书/反例/未知”的**工作流**与一个等式（Imax 定义）；证明/细节放附录。

**图表**

- 若版面允许，可把**Fig.4（左栏）\**嵌一个\**任务—规格—求解器映射图**（产品自动机的箭头图）。

------

### §5 实验验证（≈2.1 页，三线合并）

统一报告**编译等价/时间/证书**与各任务指标；图表选择“少量代表 + 表格综述”。

- **FFN（MNIST）**：
  - **Tab.2**：平均编译误差 **1.13e‑06**、全局上界 $L_{\rm upper}$、Top/Bottom‑50 的平均局部‑L 与 **FGSM ε=0.25** 成功率 **100% vs 14%**（搬自 PDF 表格与文字）。
  - **Fig.5（左栏）**：**局部‑L 分布直方图**（来自 `fig1a_mnist_lipschitz_dist.png`）。
- **CNN（CIFAR‑10 子集）**：
  - **Tab.3**：100 样本平均编译误差 **1.36e‑07**、**等变通过率 85%**、失败次数总计 58（来自 `fig2_2`/热图统计）。
  - **Fig.6（右栏）**：**等变失败热图**（`fig2_1_cnn_heatmap.png`）。**实现中平移填充值=0 的设定**源自 `exp2.py`，在附录给出“填充值=−1”的对照说明。
- **GNN（Karate Club）**：
  - **Tab.4**：编译误差均值 **2.17e‑06**；置换等变误差均值 **2.18e‑06**；Imax Top‑5/Bottom‑5 通道及消融准确率 **97.06% vs 100%**（取自 PDF 第 6–8 页）。
  - **Fig.7（并列子图）**：**Imax 分布柱状图 + 消融准确率对比条形图**（`fig3_4` + `fig3_5`）。

> **复现入口**：`python run.py --exp {1,2,3}` 触发三线实验（正文只留 1 句；细节入附录“可复现性”）。

------

### 结语 + 局限（≈0.5 页）

- 小结与影响；**局限**（非乘法门/注意力需近似；JIT 的判定性需有限细化与公平策略；Imax 上界若基于线性化需声明为非认证上界）；未来工作。
- **工程注意**（一句话提示，细节入附录）：ReLU 守卫号位、SciPy `linprog` bounds 规范化、卷积雅可比的矩阵自由实现等见“实现与健壮性附录”。（对应实现位置：`compiler.py`、`exp2.py`）

------

## 二、附录（充实证明 + 实现细节 + 扩展实验）——与正文严格去重

> 组织成 **A–K** 模块，每条定理/引理在附录有“**可核查证明**/算法/复杂度细节/边界条件”。正文只引用编号，不复述证明。

### **A. 记号、域与守卫库规范**

H‑形式、闭集合/tie=0 约定、范数与对偶、GuardSet 与可行性缓存、e‑graph 语法与共享。

### **B. AF‑1…AF‑5 的证明**

CPWL 闭包、连续性与凸性的充分条件、a.e. 可微与 Clarke 次微分、复合闭包。

### **C. SWT 语义与等价编译（SWT‑1/2/3/4/5）**

- **C.1** 编译规则的形式化（仿射/门控/Max/卷积/GNN；模板别名；滑窗守卫）。
- **C.2** **SWT‑1** 证明（逐层归纳 + 路径求值同态性）。
- **C.3** **SWT‑2**（无环与规模上界）的**精确常数**与前提（状态=结构位点/模板实例；比较面主导）。
- **C.4** **SWT‑3/4**（共同细分 + 差异区域自动机）算法与正确性。
- **C.5** **SWT‑5** NP‑难规约（从 Set‑Cover 构造“必须区分的子域族↔守卫覆盖”）。

### **D. JIT‑SWT 的语义与保证（DYN‑1…DYN‑7）**

- **D.1** LB/UB 规则的健全与**单调**（组合子保序性证明）。
- **D.2** `ENSURE_SIGN / ENSURE_WINNER / ENSURE_COMMON_REFINE` 的形式定义与**终止条件**。
- **D.3** **DYN‑1/2/3/4/5/6/7** 全证明（含**公平策略**与“有限细化可判定”的假设与证书格式）。
- **D.4** 分支定界的**复杂度上界**（LP/SOCP 次数与候选规模线性依赖）。

### **E. 函数几何与优化（GEO‑1…GEO‑5）**

- **E.1** 活跃片段提取算法与“最小公共细分”；
- **E.2** 决策边界的多面复形；
- **E.3** 极值与 Lipschitz：各域（多面体/ℓ∞/ℓ1/ℓ2 球/多面体∩球）的 LP/SOCP 形式与闭式解；
- **E.4** 向量范数的可解与 NP‑难族的处理（上界/下界的 any‑time 收敛）。

### **F. 验证/等变/因果（VER‑1/2/3，CAU‑1/2）**

- **F.1** 规格语言与**产品自动机**构造；
- **F.2** 鲁棒认证：LP/SOCP 子问题与 big‑M（how‑to 由 GuardSet LB/UB 生成**紧** big‑M）；
- **F.3** 等变验证：CNN 有效域与 stride/padding 的处理；
- **F.4** 干预闭包与 Imax 的 B&B 计算，**上下界的健全性与收敛**。

### **G. 实现与健壮性细节（工程可复现）**

- **G.1** **ReLU 守卫号位的正确公式**（正支 `(-w)^T x ≤ b`，负支 `w^T x ≤ -b`）与 tie 处理；实现位置：`compiler.py/ReLuTransition.apply`。
- **G.2** **SciPy `linprog` bounds** 需为 `[(None,None)] * n`（多处调用统一）；实现位置：`compiler.py/BranchAndBoundSolver`。
- **G.3** 卷积的**矩阵‑自由 Jacobian**（autograd 取片段雅可比，避免稠密化内存炸裂）；与 `exp2.py` 的卷积编译路径对应。
- **G.4** CNN 平移的**填充值**：归一化后“黑色”应为 −1 而非 0；在 `exp2.py/shift_image` 里的对照实现建议。
- **G.5** 运行入口与随机性：`python run.py --exp {1,2,3}`；随机种子与 DataLoader 说明。

### **H. 扩展实验与消融**

- **H.1** FFN：Spearman ρ（局部‑L vs 攻击成功）与 ε ∈ {0.1,0.2,0.25} 曲线；
- **H.2** CNN：填充值 0 vs −1 的对照热图；stride=2 的偶/奇平移对比；
- **H.3** GNN：Imax 的更充分迭代历史（多通道）、Top‑k/k’ 消融曲线、JIT 预算‑误差间隙曲线（any‑time）。

### **I. 伪代码与复杂度明细**

`ENSURE_*`、B&B 的细粒度伪代码与复杂度分析（候选数、LP/SOCP 调用次数与缓存命中率）。

### **J. 法律与伦理、数据许可证、系统环境**

数据来源与许可、硬件/软件版本、求解器限制与时限配置。

### **K. 额外图表（因篇幅移出正文）**

- per‑sample 编译误差散点（FFN/CNN/GNN）；
- GNN 置换等变误差直方图；
- Imax 收敛曲线更多通道等（均来自你现有 `fig*.png` 产物）。

------

## 三、图表与表格清单（带**放置位置**）

| 编号  | 内容                                   | 建议位置（节/栏/相对段落） | 数据/来源                                                    |
| ----- | -------------------------------------- | -------------------------- | ------------------------------------------------------------ |
| Fig.1 | 贡献地图 + 框架鸟瞰                    | §1 右栏末                  | 自绘（方法总览）；可标 4 类结论与 3 类应用                   |
| Fig.2 | 静态 SWT 编译流程图                    | §2 右栏中                  | 自绘（层→守卫交→赢家域）                                     |
| Alg.1 | JIT‑B&B 主循环伪码                     | §3 左栏首                  | 附录 I 给完整版                                              |
| Fig.3 | Imax B&B 收敛（Ch‑0）                  | §3 右栏末                  | `fig3_3_convergence_channel_0.png`                           |
| Fig.4 | 任务—规格—求解器映射                   | §4 左栏中                  | 自绘；映射到 LP/SOCP/MIP                                     |
| Fig.5 | FFN 局部‑L 分布                        | §5.1 左栏                  | `fig1a_mnist_lipschitz_dist.png`（报告第 2 页）              |
| Fig.6 | CNN 等变失败热图                       | §5.2 右栏                  | `fig2_1_cnn_heatmap.png`（报告第 4–5 页）                    |
| Fig.7 | GNN Imax 分布 + 消融准确率             | §5.3 并列子图              | `fig3_4_imax_distribution.png` + `fig3_5_accuracy_impact.png`（报告第 8 页） |
| Tab.1 | 核心定理/引理索引（正文陈述/附录证明） | §1 下方                    | 来自你大纲命名                                               |
| Tab.2 | FFN 关键指标                           | §5.1 左栏上部              | 平均编译误差 1.13e‑06、Top/Bottom‑50 局部‑L、FGSM 100% vs 14%（报告第 2–3 页） |
| Tab.3 | CNN 关键指标                           | §5.2 左栏上部              | 编译误差 1.36e‑07、通过率 85%、失败 58（报告第 4–5 页）      |
| Tab.4 | GNN 关键指标                           | §5.3 左栏上部              | 编译误差/等变误差 ~2e‑06；Top‑5/Bottom‑5 与消融（报告第 6–8 页） |

------

## 四、正文–附录去重与一致性约束（防“冲突/重复”清单）

1. **正文**仅包含：定义/问题陈述、**最小化的定理声明与直觉**、算法小伪码、关键实验图表与结论。
2. **附录**包含：所有**证明**、**完整算法**与**复杂度细节**、**实现与健壮性**、**扩展/对照实验**、**更多图表**。
3. **一致性**：正文引用的每条定理在附录有对应条目（A–K 索引表），且编号一致；实验数值以 PDF/脚本为准（表格来源行标注）。例如：FFN 的编译误差、FGSM 成功率、CNN 的通过率和热图、GNN 的 Imax 消融，分别对应报告页码/图片文件与 `exp*.py` 生成逻辑。
4. **实现注意**（避免正文争议）：ReLU 守卫方向、`linprog` bounds、卷积雅可比矩阵自由、CNN 填充值对照全都放入附录 G；正文只在“局限”处一行提示。实现修改点与路径在 `compiler.py`、`exp2.py` 明确标注。

------

## 五、可复现性与Artifact（附录 G/J 引用）

- **命令入口**：`python run.py --exp 1|2|3`（三线实验）。
- **脚本—任务映射**：FFN（`exp1.py`，动态编译、局部‑L、FGSM）；CNN（`exp2.py`，平移等变与热图）；GNN（`exp3.py`，置换等变、Imax、消融）。
- **实现要点**：符号编译器与 B&B 在 `compiler.py`；求解器为 SciPy HiGHS；随机种子/阈值/超参见附录 G/J。

------

### 结束语

按上面的架构，你可以**直接开始撰写正文**，把证明/实现细节/更多图放入附录 A–K。实验数字与图已有**原文件支撑**，引文与可复现路径也已标注清楚。这样既满足 ICLR 九页限制，又保证学术完整性与可核查性。